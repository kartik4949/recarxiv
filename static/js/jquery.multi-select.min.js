(function(d){function g(a,b){this.b=d(a);this.a=d.extend({},h,b);this.L()}var h={containerHTML:'<div class="multi-select-container">',menuHTML:'<div class="multi-select-menu">',buttonHTML:'<span class="multi-select-button">',menuItemsHTML:'<div class="multi-select-menuitems">',menuItemHTML:'<label class="multi-select-menuitem">',presetsHTML:'<div class="multi-select-presets">',modalHTML:void 0,activeClass:"multi-select-container--open",noneText:"-- Select --",allText:void 0,presets:void 0,positionedMenuClass:"multi-select-container--positioned",
positionMenuWithin:void 0,viewportBottomGutter:20,menuMinHeight:200};d.extend(g.prototype,{L:function(){this.B();this.K();this.D();this.C();this.F();this.I();this.M();this.N();this.b.hide()},B:function(){if(!1===this.b.is("select[multiple]"))throw Error("$.multiSelect only works on <select multiple> elements");},K:function(){this.l=d('label[for="'+this.b.attr("id")+'"]')},D:function(){this.f=d(this.a.containerHTML);this.b.data("multi-select-container",this.f);this.f.insertAfter(this.b)},C:function(){var a=
this;this.g=d(this.a.buttonHTML);this.g.attr({role:"button","aria-haspopup":"true",tabindex:0,"aria-label":this.l.eq(0).text()}).on("keydown.multiselect",function(b){var c=b.which;13===c||32===c?(b.preventDefault(),a.g.click()):40===c?(b.preventDefault(),a.o(),(a.h||a.i).children(":first").focus()):27===c&&a.j()}).on("click.multiselect",function(){a.s()}).appendTo(this.f);this.b.on("change.multiselect",function(){a.v()});this.v()},v:function(){var a=[],b=[];this.b.children("option").each(function(){var c=
d(this).text();a.push(c);d(this).is(":selected")&&b.push(d.trim(c))});this.g.empty();0==b.length?this.g.text(this.a.noneText):b.length===a.length&&this.a.allText?this.g.text(this.a.allText):this.g.text(b.join(", "))},F:function(){var a=this;this.c=d(this.a.menuHTML);this.c.attr({role:"menu"}).on("keyup.multiselect",function(b){27===b.which&&(a.j(),a.g.focus())}).appendTo(this.f);this.H();this.a.presets&&this.J()},H:function(){var a=this;this.i=d(this.a.menuItemsHTML);this.c.append(this.i);this.b.on("change.multiselect",
function(b,c){!0!==c&&a.w()});this.w()},w:function(){var a=this;this.i.empty();this.b.children("option").each(function(b,c){b=a.G(d(c),b);a.i.append(b)})},u:function(a,b){var c=b.which;38===c?(b.preventDefault(),b=d(b.currentTarget).prev(),b.length?b.focus():this.h&&"menuitem"===a?this.h.children(":last").focus():this.g.focus()):40===c&&(b.preventDefault(),b=d(b.currentTarget).next(),b.length||"menuitem"===a?b.focus():this.i.children(":first").focus())},J:function(){var a=this;this.h=d(this.a.presetsHTML);
this.c.prepend(this.h);d.each(this.a.presets,function(b,c){b=a.b.attr("name")+"_preset_"+b;var e=d(a.a.menuItemHTML).attr({"for":b,role:"menuitem"}).text(" "+c.name).on("keydown.multiselect",a.u.bind(a,"preset")).appendTo(a.h);d("<input>").attr({type:"radio",name:a.b.attr("name")+"_presets",id:b}).prependTo(e).on("change.multiselect",function(){a.b.val(c.options);a.b.trigger("change")})});this.b.on("change.multiselect",function(){a.A()});this.A()},A:function(){var a=this;d.each(this.a.presets,function(b,
c){b=a.b.attr("name")+"_preset_"+b;b=a.h.find("#"+b);a:{c=c.options||[];var e=a.b.val()||[];if(c.length!=e.length)c=!1;else{c.sort();e.sort();for(var f=0;f<c.length;f++)if(c[f]!==e[f]){c=!1;break a}c=!0}}c?b.prop("checked",!0):b.prop("checked",!1)})},G:function(a,b){var c=this.b.attr("name")+"_"+b;b=d(this.a.menuItemHTML).attr({"for":c,role:"menuitem"}).on("keydown.multiselect",this.u.bind(this,"menuitem")).text(" "+a.text());c=d("<input>").attr({type:"checkbox",id:c,value:a.val()}).prependTo(b);
a.is(":disabled")&&c.attr("disabled","disabled");a.is(":selected")&&c.prop("checked","checked");c.on("change.multiselect",function(){d(this).prop("checked")?a.prop("selected",!0):a.prop("selected",!1);a.trigger("change",[!0])});return b},I:function(){var a=this;this.a.modalHTML&&(this.m=d(this.a.modalHTML),this.m.on("click.multiselect",function(){a.j()}),this.m.insertBefore(this.c))},M:function(){var a=this;d("html").on("click.multiselect",function(){a.j()});this.f.on("click.multiselect",function(b){b.stopPropagation()})},
N:function(){var a=this;this.l.on("click.multiselect",function(b){b.preventDefault();b.stopPropagation();a.s()})},o:function(){d("html").trigger("click.multiselect");this.f.addClass(this.a.activeClass);if(this.a.positionMenuWithin&&this.a.positionMenuWithin instanceof d){var a=this.c.offset().left+this.c.outerWidth(),b=this.a.positionMenuWithin.offset().left+this.a.positionMenuWithin.outerWidth();a>b&&(this.c.css("width",b-this.c.offset().left),this.f.addClass(this.a.positionedMenuClass))}a=this.c.offset().top+
this.c.outerHeight();b=d(window).scrollTop()+d(window).height();a>b-this.a.viewportBottomGutter?this.c.css({maxHeight:Math.max(b-this.a.viewportBottomGutter-this.c.offset().top,this.a.menuMinHeight),overflow:"scroll"}):this.c.css({maxHeight:"",overflow:""})},j:function(){this.f.removeClass(this.a.activeClass);this.f.removeClass(this.a.positionedMenuClass);this.c.css("width","auto")},s:function(){this.f.hasClass(this.a.activeClass)?this.j():this.o()}});d.fn.multiSelect=function(a){return this.each(function(){d.data(this,
"plugin_multiSelect")||d.data(this,"plugin_multiSelect",new g(this,a))})}})(jQuery);
